						2018-4-29 

 Xmodemでファイルを送り SDカードに書き込むプログラム  (Arduino Uno)


■概要
  Arduino Uno + SDカードシールドで、X-modemでPCから
  ファイルを送信してSDカードに書き込むプログラム。

■必要なもの
  ・Arduino Uno
  ・SDカードシールド
  ・SDカード (FATでフォーマットされていること)
  ・PC側はTeraTermをインストールしてある事


■注意
  ・本プログラムは無保証です。作者は使用した事による一切の結果に責任を持ちません。
  ・SDカードは必ず専用に用意する事。
    書き込みに失敗したら保存してあった他のファイルを巻き添えに読めなくなる可能性が高いです。
  ・転送に失敗する、lコマンドで一覧が出ないなどの不具合現象が起きる事があります。

■使用
  (1) Arduino IDEでコンパイルし、SDカードを刺してあるSDカードシールド
      を接続した Unoに書き込む。
      当方はArduino 1.8.5で確認しています。
  (2) 該当のCOMポートにTeraTermでシリアル、115200bpsで接続する。
      プロンプト">"が出る。
  (3) ファイルの書き込みは、u <filename> をプロンプトで入れてリターン、
      16秒以内に TeraTermの ファイル→転送→XMODEM→送信 で、
      書き込むファイルを選択する事。
         ※(理由)XMODEMは受信側が送信側にNAKを送る事でスタートする。
                 このプログラムは16秒後に1回しか出さない。

■制約
   ・ファイル名は 8.3文字形式、使用文字はAlpha Numericのみ。
   ・ファイルにタイムスタンプは付けられない。表示もできない。
   ・ファイル名を指定するコマンドではワイルドカードは使えない。
   ・サブディレクトリは扱えない。
   ・SDカードの空き容量もわからない。
   ・Xmodemで転送中は他のWindowsアプリに切替えるなどはしない方がいい。
     (他のウィンドウを選択すると転送が中断しやすい)
   ・生成されたファイルのサイズは128バイト単位になる。例えば129バイトの
     ファイルを転送すると256バイトになり、ファイル末尾に余分なデータが
     付く。
   ・転送速度は115200bpsより速くできない。


■TeraTerm画面例
----------------------------------------
>Arduino SD card shield file manager terminal 0.1  2018-4 by espilab
>Initializing SD card...initialization done.
>
>?
 l            : list files in SD card
 u <filename> : upload file
 d <filename> : delete file
 0            : initialize
 ?            : show help

>l
        SAMPLE.BIN              5
        A.BIN           514432
ok
>
----------------------------------------


以上


